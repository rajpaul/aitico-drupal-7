(function($){
    $(document).ready(function(){
       
        $("#delete-node").hide();
      
        $(".tree_table tr").click(function(){
          
            $("#delete-node").show();
          
            if($(this).hasClass("active")){
                $(this).removeClass("selected");
                $(this).removeClass("active");
                $("#tree_url").text("Add Company");
                $("#tree_url").attr("href", "administration/company/add");
                $("#delete-node").hide();
                return;
            }
          
            $(".tree_table tr").removeClass("active");         
            $(this).addClass("active");
          
            var type = $(this).attr("type");            
            var nid = $(this).attr("nid");
            var company_id = 0;
            var site_id = 0;
            var cst_id = 0;
            if(type == 'company'){
                company_id = nid;
            }else if (type == 'site'){
                site_id = nid;
                company_id = $(this).data('tt-parent-id');
            }else if (type == 'charging_station'){                 
                company_id = $(this).prevAll("tr.company:first").attr("nid");                                
                cst_id = nid;
                site_id = $(this).data('tt-parent-id');
            }            
            
            $.ajax({
                url: "/update/admin/action",
                type: 'POST',    
                data : {
                    'node_type' : type,
                    'company_id' : company_id,
                    'site_id' : site_id,
                    'cst_id' : cst_id
                },
                success: function(response) {                     
                    if(response){                         
                        $('#admin-action').show();
                        $('#tab-group').html(response); 
                        $("#admin-action #myTab li").removeClass("active");
                        $("#admin-action #myTab li:eq(0)").addClass("active");
                        $('#user-delete').hide();
                        $('#user-edit').hide();                             
                    }                   
                    
                }
            });       
            
                          
            $("#tree_url").show();
            $("#delete-node").show();              
            if(type == "company"){
                $("#tree_url").text("Add Site");
                $("#tree_url").attr("href", "/administration/site/add/"+nid);
                $("#delete-node").text("Delete Company");
                $("#delete-node").attr("href", "/administration/company/remove/"+nid);
            }
            else if(type == "site"){
                $("#tree_url").text("Add Charging Station");
                $("#tree_url").attr("href", "/administration/cst/add"+nid);
                $("#delete-node").text("Delete Site");
                $("#delete-node").attr("href", "/administration/site/remove/"+nid);
            }
            else if(type == "charging_station"){
                $("#tree_url").hide();
                $("#delete-node").text("Delete Charging Station");
                $("#delete-node").attr("href", "/administration/cst/remove/"+nid);
            }
            else if (type == "device"){
                $("#tree_url").hide();
                $("#delete-node").hide();               
            }             
        });
        
        //User table js action
        $("#usertable tr").live('click',  function(){                              
            if(!$('#usertable tr td').is('.dataTables_empty')){
                $('#user-delete').attr('href','/user/'+$(this).data('user-id')+'/cancel');
                $('#user-edit').attr('href','/administration/user/edit/'+$(this).data('user-id'));
                if($("#usertable").has('thead')){
                    $('#user-edit').show();
                    $('#user-delete').show();  
                }
            }
            
         
        });   
    });
   
})(jQuery);
